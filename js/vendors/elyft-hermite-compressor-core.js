// Elyft Compressor, compress image with Hermite algorithm
// thank you to Vilius for the help that i took inside his source code
// Author: Nguetseng Stephane
export function ElyftCompressor(){var v=[];var p=navigator.hardwareConcurrency||4;this.init=void 0;this.getCores=function(){return p};this.resample_auto=function(a,d,b,w,l){var f=this.getCores();window.Worker&&1<f?this.resample(a,d,b,w,l):(this.resample_single(a,d,b,!0),void 0!=l&&l())};this.resize_image=function(a,d,b,w,l){var f=document.getElementById(a),g=document.createElement("canvas");g.width=f.width;g.height=f.height;g.getContext("2d").drawImage(f,0,0);void 0==d&&void 0==b&&void 0!=w&&(d=f.width/
100*w,b=f.height/100*w);void 0==b&&(b=f.height/(f.width/d));d=Math.round(d);b=Math.round(b);a=function(){var a=g.toDataURL();f.width=d;f.height=b;f.src=a;g=null};void 0==l||1==l?this.resample(g,d,b,!0,a):(this.resample_single(g,d,b,!0),a())};this.resample=function(a,d,b,w,l){var f=a.width,g=a.height;d=Math.round(d);b=Math.round(b);var t=g/b;if(0<v.length)for(var e=0;e<p;e++)void 0!=v[e]&&(v[e].terminate(),delete v[e]);v=Array(p);var H=a.getContext("2d"),c=[],h=2*Math.ceil(g/p/2),q=-1;for(e=0;e<p;e++){var n=
q+1;if(!(n>=g)){q=n+h-1;q=Math.min(q,g-1);var r=h;r=Math.min(h,g-n);c[e]={};c[e].source=H.getImageData(0,n,f,h);c[e].target=!0;c[e].start_y=Math.ceil(n/t);c[e].height=r}}!0===w?(a.width=d,a.height=b):H.clearRect(0,0,f,g);var u=0;for(e=0;e<p;e++)void 0!=c[e].target&&(u++,a=new Worker(N),v[e]=a,a.onmessage=function(a){u--;var b=a.data.core;v[b].terminate();delete v[b];c[b].target=H.createImageData(d,Math.ceil(c[b].height/t));c[b].target.data.set(a.data.target);H.putImageData(c[b].target,0,c[b].start_y);
0>=u&&void 0!=l&&l()},b={width_source:f,height_source:c[e].height,width:d,height:Math.ceil(c[e].height/t),core:e,source:c[e].source.data.buffer},a.postMessage(b,[b.source]))};var N=window.URL.createObjectURL(new Blob(["(",function(){onmessage=function(a){var d=a.data.core,b=a.data.width_source,w=a.data.height_source,l=a.data.width,f=a.data.height,g=b/l,t=w/f,e=Math.ceil(g/2),v=Math.ceil(t/2);a=new Uint8ClampedArray(a.data.source);var c=l*f*4,h=new ArrayBuffer(c);c=new Uint8ClampedArray(h,0,c);for(h=
0;h<f;h++)for(var q=0;q<l;q++){var n=4*(q+h*l),r=0,u=0,L=0,z=0,p=0,F=0,I=h*t,J=Math.floor(q*g),B=Math.ceil((q+1)*g),C=Math.floor(h*t),G=Math.ceil((h+1)*t);B=Math.min(B,b);for(G=Math.min(G,w);C<G;C++){var A=Math.abs(I-C)/v,D=q*g;A*=A;for(var x=J;x<B;x++){var k=Math.abs(D-x)/e;k=Math.sqrt(A+k*k);if(!(1<=k)){k=2*k*k*k-3*k*k+1;var y=4*(x+C*b);F+=k*a[y+3];u+=k;255>a[y+3]&&(k=k*a[y+3]/250);L+=k*a[y];z+=k*a[y+1];p+=k*a[y+2];r+=k}}}c[n]=L/r;c[n+1]=z/r;c[n+2]=p/r;c[n+3]=F/u}postMessage({core:d,target:c},[c.buffer])}}.toString(),
")()"],{type:"application/javascript"}));this.resample_single=function(a,d,b,w){var l=a.width,f=a.height;d=Math.round(d);b=Math.round(b);var g=l/d,t=f/b,e=Math.ceil(g/2),v=Math.ceil(t/2),c=a.getContext("2d"),h=c.getImageData(0,0,l,f),q=c.createImageData(d,b);h=h.data;for(var n=q.data,r=0;r<b;r++)for(var u=0;u<d;u++){var p=4*(u+r*d),z=0,M=0,F=0,I=0,J=0,B=0,C=r*t,G=Math.floor(u*g),A=Math.ceil((u+1)*g),D=Math.floor(r*t),x=Math.ceil((r+1)*t);A=Math.min(A,l);for(x=Math.min(x,f);D<x;D++){var k=Math.abs(C-
D)/v,y=u*g;k*=k;for(var K=G;K<A;K++){var m=Math.abs(y-K)/e;m=Math.sqrt(k+m*m);if(!(1<=m)){m=2*m*m*m-3*m*m+1;var E=4*(K+D*l);B+=m*h[E+3];M+=m;255>h[E+3]&&(m=m*h[E+3]/250);F+=m*h[E];I+=m*h[E+1];J+=m*h[E+2];z+=m}}}n[p]=F/z;n[p+1]=I/z;n[p+2]=J/z;n[p+3]=B/M}!0===w?(a.width=d,a.height=b):c.clearRect(0,0,l,f);c.putImageData(q,0,0)}};
